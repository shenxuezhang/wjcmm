<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SHEIN备货下单计算器</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container">
    <h1>📦 SHEIN备货下单计算器</h1>

    <!-- 功能卡片区域 -->
    <div class="function-cards-wrapper">
      <!-- 文件上传区域 -->
      <div class="upload-section" id="uploadSection">
        <div class="card-header">
          <h2>文件操作</h2>
        </div>
        <div class="card-content">
          <div class="file-input-wrapper">
            <input type="file" id="fileInput" accept=".xls,.xlsx" style="display: none;">
            <button class="btn btn-primary" id="fileSelectBtn" onclick="document.getElementById('fileInput').click()">
              选择Excel文件<span id="dataCountDisplay"></span>
            </button>
            <button class="btn btn-secondary" onclick="clearData()">清空数据</button>
            <button class="btn btn-danger" id="deleteBtn" onclick="deleteSelectedRows()" style="display: none;" disabled>
              删除选中
            </button>
            <button class="btn btn-primary" id="exportBtn" onclick="exportToExcel()" style="display: none;">
              导出数据
            </button>
          </div>
        </div>
      </div>

      <!-- 筛选和搜索栏 -->
      <div class="filter-section" id="filterSection" style="display: none;">
        <div class="card-header">
          <h2>筛选与搜索</h2>
        </div>
        <div class="card-content">
      <div class="filter-bar">
        <div class="filter-group">
          <label>质量等级：</label>
          <div class="quality-level-filter-wrapper">
            <button class="btn btn-secondary quality-level-toggle" id="qualityLevelToggle" onclick="toggleQualityLevelDropdown()">
              选择质量等级<span id="qualityLevelCount"></span>
            </button>
            <div class="quality-level-dropdown" id="qualityLevelDropdown" style="display: none;">
              <div class="quality-level-options" id="qualityLevelOptions">
              </div>
              <div class="quality-level-actions">
                <button class="btn btn-sm btn-primary" onclick="selectAllQualityLevels()">全选</button>
                <button class="btn btn-sm btn-secondary" onclick="clearQualityLevels()">清空</button>
              </div>
            </div>
          </div>
        </div>
        <div class="filter-group">
          <label>实际建议单数：</label>
          <select id="actualOrderOperator" class="filter-operator">
            <option value="=">=</option>
            <option value=">">&gt;</option>
            <option value="<">&lt;</option>
            <option value=">=">&gt;=</option>
            <option value="<=">&lt;=</option>
          </select>
          <input type="number" id="actualOrderValue" class="filter-input" placeholder="输入数值">
        </div>
        <button class="btn btn-secondary" onclick="clearFilters()">清除筛选</button>
      </div>
      <div class="search-bar">
        <div class="search-group">
          <label>供货方号：</label>
          <input type="text" id="supplierCodeSearch" class="search-input" placeholder="输入供货方号">
        </div>
        <div class="search-group">
          <label>SKC：</label>
          <input type="text" id="skcSearch" class="search-input" placeholder="输入SKC">
          <button class="btn btn-primary" onclick="searchAll()">搜索</button>
        </div>
        <button class="btn btn-secondary" onclick="clearSearch()">清除搜索</button>
      </div>
        </div>
      </div>
    </div>

    <!-- 骨架屏 -->
    <div class="skeleton-wrapper" id="skeletonWrapper" style="display: none;">
      <div id="skeletonContent"></div>
    </div>

    <!-- 数据表格 -->
    <div class="table-wrapper" id="tableWrapper" style="display: none;">
      <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
      </div>
      <table id="dataTable">
        <thead>
          <tr>
            <th class="checkbox-header">
              <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(this.checked)">
              <label for="selectAllCheckbox">选择框</label>
            </th>
            <th>图片</th>
            <th>供货方号</th>
            <th>SKC</th>
            <th>SKU</th>
            <th>属性集</th>
            <th>质量等级</th>
            <th>SHEIN仓库存</th>
            <th>
              预测日销
              <span class="formula-icon" title="计算公式">
                ?
                <span class="formula-tooltip">
                  <span class="formula-tooltip-title">预测日销计算公式</span>
                  <span class="formula-tooltip-content">
                    <span class="formula-tooltip-formula">预测日销 = 近7天销量 ÷ 7</span>
                  </span>
                </span>
              </span>
            </th>
            <th>实际建议单数</th>
            <th>
              建议下单数
              <span class="formula-icon" title="计算公式">
                ?
                <span class="formula-tooltip">
                  <span class="formula-tooltip-title">建议下单数计算公式</span>
                  <span class="formula-tooltip-content">
                    <span class="formula-tooltip-formula">建议下单数 = 预测日销 × (货期 + 备货天数) - 待发货 - 在途 - 待上架 - SHEIN仓库存</span>
                    <div style="margin-top: 8px; font-size: 12px; color: #8c959f;">
                      四舍五入规则：按5的倍数向上取整；若计算结果 &lt; 5，则直接取5件
                    </div>
                  </span>
                </span>
              </span>
            </th>
          </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
      </table>
    </div>

    <div id="emptyState" class="empty-state">
      <div class="empty-state-icon" id="emptyStateIcon">📊</div>
      <div id="emptyStateText">正在加载Excel解析库...</div>
    </div>
  </div>

  <!-- 按顺序加载JavaScript模块 -->
  <script src="js/config/constants.js"></script>
  <script src="js/utils/xlsxLoader.js"></script>
  <script src="js/utils/fileParser.js"></script>
  <script src="js/utils/calculator.js"></script>
  <script src="js/utils/filterService.js"></script>
  <script src="js/utils/tableRenderer.js"></script>
  <script src="js/services/excelService.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
